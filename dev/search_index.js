var documenterSearchIndex = {"docs":
[{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"EditURL = \"https://github.com/blegat/SetProg.jl/blob/master/docs/src/examples/Discrete-time Controlled Invariant Set.jl\"","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Discrete-time-Controlled-Invariant-Set","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"(Image: Binder) (Image: nbviewer)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"An similar example is available in a codeocean capsule.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Introduction","page":"Discrete-time Controlled Invariant Set","title":"Introduction","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"This example considers the linear control system already introduced in the Example 2 of LTJ20:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"beginalign*\nx_k+1  = x_k + u_k  2\nu_k+1  = u_k\nendalign*","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"with (x_k u_k) in -1 1^2.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The system is x_k+1 = Ax_k + Bu_k where B = (0 1) and","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"A = beginbmatrix\n1  12\n0  0\nendbmatrix","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"As shown in Example 4 of [LTJ18], a set S subseteq -1 1^2 is controlled invariant for this system if","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"beginbmatrix\n1  12\nendbmatrix\nS subseteq\nbeginbmatrix\n1  0\nendbmatrix\nS","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"[LRJ20] Legat, Benoît, Saša V. Raković, and Raphaël M. Jungers. Piecewise semi-ellipsoidal control invariant sets. IEEE Control Systems Letters 5.3 (2020): 755-760.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"[LTJ18] B. Legat, P. Tabuada and R. M. Jungers. Computing controlled invariant sets for hybrid systems with applications to model-predictive control. 6th IFAC Conference on Analysis and Design of Hybrid Systems ADHS 2018, 2018.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We need to pick an LP and an SDP solver, see here for a list of available ones. Run one of the following two cells to choose choose the solver.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"using SetProg\nimport GLPK\nlp_solver = optimizer_with_attributes(GLPK.Optimizer, MOI.Silent() => true)\nimport CSDP\nsdp_solver = optimizer_with_attributes(CSDP.Optimizer, MOI.Silent() => true)\nA = [1.0 0.5]\nE = [1.0 0.0]\nusing Polyhedra\nlib = DefaultLibrary{Float64}(lp_solver)\nh = HalfSpace([1, 0], 1.0) ∩ HalfSpace([-1, 0], 1) ∩ HalfSpace([0, 1], 1) ∩ HalfSpace([0, -1], 1)\n□ = polyhedron(h, lib) # [0, 1]^2\nv = convexhull([1.0, 0], [0, 1], [-1, 0], [0, -1])\n◇ = polyhedron(v, lib); # polar of [0, 1]^2\nnothing #hide","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Polyhedral-template","page":"Discrete-time Controlled Invariant Set","title":"Polyhedral template","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/#Fixed-point-approach","page":"Discrete-time Controlled Invariant Set","title":"Fixed point approach","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"This section shows that the maximal control invariant set of this simple control system is polyhedral. Moreover, this polyhedron is obtained after only one fixed point iteration of the standard viability kernel algorithm. We implement the fixed point iteration with the following function:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"function fixed_point_iteration(set::Polyhedron)\n    new_set = set ∩ (A \\ (E * set))\n    removehredundancy!(new_set)\n    return new_set\nend","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We start with -1 1^2 and obtain the polytope mci after one iteration.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"mci = fixed_point_iteration(□)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"One additional iteration gives the same polytope, showing that this polytope is control invariant.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"fixed_point_iteration(mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We plot this polytope mci in yellow below along with the safe set -1 1^2 in green.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"using Plots\nfunction hexcolor(rgb::UInt32)\n    r = ((0xff0000 & rgb) >> 16) / 255\n    g = ((0x00ff00 & rgb) >>  8) / 255\n    b = ((0x0000ff & rgb)      ) / 255\n    Plots.RGBA(r, g, b)\nend","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Values taken from http://www.toutes-les-couleurs.com/code-couleur-rvb.php","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"lichen = hexcolor(0x85c17e)\ncanard = hexcolor(0x048b9a)\naurore = hexcolor(0xffcb60)\n\nplot(ratio=:equal, tickfont=Plots.font(12))\nplot!(□, color=lichen)\nplot!(mci, color=aurore)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We also plot their respective polars. Note that the inclusion is reversed in the polar space.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_mci = polar(mci)\nplot(ratio=:equal, tickfont=Plots.font(12))\nplot!(polar_mci, color=aurore)\nplot!(◇, color=lichen)\n\nfunction maximal_invariant(template, heuristic::Function)\n    solver = if template isa Polytope\n        lp_solver\n    else\n        sdp_solver\n    end\n    model = Model(solver)\n    @variable(model, S, template)\n    @constraint(model, S ⊆ □)\n    @constraint(model, A * S ⊆ E * S)\n    @objective(model, Max, heuristic(volume(S)))\n    optimize!(model)\n    @show solve_time(model)\n    @show termination_status(model)\n    @show objective_value(model)\n    return value(S)\nend\nfunction primal_plot(set; npoints=256, args...)\n    plot(ratio=:equal, tickfont=Plots.font(12); args...)\n    plot!(□, color=lichen)\n    plot!(mci, color=aurore)\n    plot!(set, color=canard, npoints=npoints)\nend\nfunction polar_plot(set; npoints=256, args...)\n    plot(ratio=:equal, tickfont=Plots.font(12); args...)\n    plot!(SetProg.Sets.polar(set), color=canard, npoints=npoints)\n    plot!(polar_mci, color=aurore)\n    plot!(◇, color=lichen)\nend","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Linear-programming-approach","page":"Discrete-time Controlled Invariant Set","title":"Linear programming approach","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"As introduced in [R21], given a fixed polyhedral conic partition of the state-space, we can search over all polyhedra for which the gauge or support function is linear over each piece of the partition. The partition can be defined by a polytope as described in [Eq. (4.6), R21]. In this example, because the sets are represented with the support function, the pieces will be used for the support function/polar set and the pieces of the gauge function/primal will depend on the value of the support function on each piece.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"[R21] Raković, S. V. Control Minkowski–Lyapunov functions Automatica, Elsevier BV, 2021, 128, 109598","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Let's start with setting the partition using the cross polytope ◇.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_polytope_◇ = maximal_invariant(Polytope(symmetric=true, piecewise=◇), L1_heuristic)\nSetProg.Sets.print_support_function(sol_polytope_◇)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We can see that the polar set is unbounded so the primal set has zero volume. More precisely, the polar is -1 1 times -infty infty and the primal set is -1 1 times 0.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Let's now try setting the partition using the square □.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_polytope_□ = maximal_invariant(Polytope(symmetric=true, piecewise=□), L1_heuristic)\nSetProg.Sets.print_support_function(sol_polytope_□)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_polytope_□)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_polytope_□)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Let's now use a partition with 8 pieces.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"pieces8 = convexhull(□, 1.25 * ◇)\nsol_polytope_8 = maximal_invariant(Polytope(symmetric=true, piecewise=pieces8), L1_heuristic)\nSetProg.Sets.print_support_function(sol_polytope_8)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_polytope_8)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_polytope_8)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We can use the polar of the polytope resulting from the first fixed point iteration to generate a refined conic partition. With this partition, the maximal piecewise semi-ellipsoidal control invariant set matches the maximal control invariant set.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_polytope_mci = maximal_invariant(Polytope(symmetric=true, piecewise=polar_mci), L1_heuristic)\nSetProg.Sets.print_support_function(sol_polytope_mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_polytope_mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_polytope_mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Ellipsoidal-template","page":"Discrete-time Controlled Invariant Set","title":"Ellipsoidal template","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We now compute the maximal ellipsoidal control invariant set. Here we can either maximize its volume (which corresponds to log(det(Q)) or sqrtndet(Q) in the objective function) or minimize the sum of the squares of the length of its semi-axes of the polar (which corresponds to the trace of Q in the objective function).","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We can see below that the control invariant set of maximal volume has support function h^2(S x) = x_1^2 - frac12 x_1x_2 + x_2^2","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_ell_vol = maximal_invariant(Ellipsoid(symmetric=true, dimension=2), nth_root)\nSetProg.Sets.print_support_function(sol_ell_vol)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We can see below the ellipsoid in blue along with the maximal control invariant set in yellow and the safe set in green.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_ell_vol)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Below is are the corresponding sets in the polar space.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_ell_vol)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We can see below that the control invariant set of minimal sum of squares of the length of the semi-axes of the polar has support function h^2(S x) = x_1^2 - alpha x_1x_2 + x_2^2 with alpha approx 1377456. Note that the sum of the squares of the length of the semi-axes of the polar is equal to the integral of h^2(S x) over the hypercube -1 1^2 hence the use of the L1_heuristic(vol, ones(2)) as objective which means taking the integral over the hyperrectangle with vertex ones(2) = [1, 1].","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_ell_L1 = maximal_invariant(Ellipsoid(symmetric=true, dimension=2), vol -> L1_heuristic(vol, ones(2)))\nSetProg.Sets.print_support_function(sol_ell_L1)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_ell_L1)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_ell_L1)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Piecewise-semi-ellipsoidal-template","page":"Discrete-time Controlled Invariant Set","title":"Piecewise semi-ellipsoidal template","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We now study the maximal piecewise semi-ellipsoidal control invariant sets of a given conic partition. The volume is not directly maximized. Instead, for each cone, we compute the sum s of the normalized rays and consider the polytope obtained by intersecting the cone with the halfspace s^top x le s_2^2. We integrate the quadratic form corresponding to this cone, i.e. h^2(S x) over the polytope. The sum of the integrals over each polytope is the objective function we use. This can be seen as the generalization of the sum of the squares of the semi-axes of the polar of the ellipsoid.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Note that the constraint (29) of Program 1 of [LRJ20] is implemented with Proposition 2 of [LRJ20] for all results of this example.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The conic partition are obtained by considering the conic hull of each facets of a given polytope. We first consider the conic partition corresponding to the polar of the safe set -1 1^2. This gives the four quadrants as cones of the conic partition. The maximal piecewise semi-ellipsoidal control invariant set with this partition has the following support function: $ h^2(S, x) = \\begin{cases} (x1 - x2)^2 & \\text{ if }x1x2 \\le 0,\\\nx1^2 - x1x2/2 + x2^2 & \\text{ if }x1x2 \\ge 0. \\end{cases} $ For the cones x_1x_2 le 0, the semi-ellipsoid matches the safe set and the maximal control invariant set. For the cones x_1x_2 ge 0, the semi-ellipsoid matches the maximal volume control invariant ellipsoid. This illustrates one key feature of piecewise semi-ellipsoidal sets, they can combines advantages of both polyhedra and ellipsoids. It can be polyhedral on the directions where the maximal control invariant set is polyhedral and be ellipsoidal on the directions where the maximal control invariant set is smooth or requires many halfspaces in its representation.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_piece_◇ = maximal_invariant(Ellipsoid(symmetric=true, piecewise=◇), L1_heuristic)\nSetProg.Sets.print_support_function(sol_piece_◇)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_piece_◇, xlim=(-1.05, 1.05), ylim=(-1.05, 1.05))","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_piece_◇, xlim=(-1.05, 1.05), ylim=(-1.05, 1.05))","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Let's now try setting the partition with the square □.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_piece_□ = maximal_invariant(Ellipsoid(symmetric=true, piecewise=□), L1_heuristic)\nSetProg.Sets.print_support_function(sol_piece_□)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_piece_□, xlim=(-1.05, 1.05), ylim=(-1.05, 1.05))","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_piece_□, xlim=(-1.6, 1.6), ylim=(-1.6, 1.6))","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Let's now try with the partition of 8 pieces.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_piece_8 = maximal_invariant(Ellipsoid(symmetric=true, piecewise=pieces8), L1_heuristic)\nSetProg.Sets.print_support_function(sol_piece_8)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_piece_8, xlim=(-1.05, 1.05), ylim=(-1.05, 1.05))","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_piece_8, xlim=(-1.1, 1.1), ylim=(-1.05, 1.05))","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We can use the polar of the polytope resulting from the first fixed point iteration to generate a refined conic partition. With this partition, the maximal piecewise semi-ellipsoidal control invariant set matches the maximal control invariant set. The support function is $ h^2(S, x) = \\begin{cases} (x1 - x2)^2 & \\text{ if }x1x2 \\le 0,\\\nx1^2 & \\text{ if }x2(x1-2x2) \\ge 0,\\\n(x1/2 + x2)^2 & \\text{ if }x1(2x2-x_1) \\ge 0.\\\n\\end{cases} $","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol_piece_mci = maximal_invariant(Ellipsoid(symmetric=true, piecewise=polar_mci), L1_heuristic)\nSetProg.Sets.print_support_function(sol_piece_mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol_piece_mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol_piece_mci)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/#Polyset-template","page":"Discrete-time Controlled Invariant Set","title":"Polyset template","text":"","category":"section"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"We now use the polyset templates. As details in [LRJ20], for inclusion constraints of the form A * S ⊆ E * S, the polar representation is used so we need the set to be convex. For this, we set the argument convex=true. We directly try degree=4 because degree=2 would simply give the same as sol_ell_L1.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol4 = maximal_invariant(PolySet(symmetric=true, degree=4, convex=true), vol -> L1_heuristic(vol, ones(2)))\nSetProg.Sets.print_support_function(sol4)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol4)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol4)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"Let's now try degree 6.","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"sol6 = maximal_invariant(PolySet(symmetric=true, degree=6, convex=true), vol -> L1_heuristic(vol, ones(2)))\nSetProg.Sets.print_support_function(sol6)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"The primal plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"primal_plot(sol6)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"And the polar plot is below:","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"polar_plot(sol6)","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"","category":"page"},{"location":"generated/Discrete-time Controlled Invariant Set/","page":"Discrete-time Controlled Invariant Set","title":"Discrete-time Controlled Invariant Set","text":"This page was generated using Literate.jl.","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"EditURL = \"https://github.com/blegat/SetProg.jl/blob/master/docs/src/examples/Continuous-time Controlled Invariant Set.jl\"","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/#Continuous-time-Controlled-Invariant-Set","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"","category":"section"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"(Image: Binder) (Image: nbviewer)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/#Introduction","page":"Continuous-time Controlled Invariant Set","title":"Introduction","text":"","category":"section"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"This reproduces reproduces the numerical result of the Section 4 of [LJ21].","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"This example considers the continuous-time constrained linear control system:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"beginaligned\ndotx_1(t)  = x_2(t)\ndotx_2(t)  = u(t)\nendaligned","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"with state constraint x in -1 1^2 and input constraint u in -1 1.","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"In order to compute controlled invariant sets for this system, we consider the projection onto the first two dimensions of controlled invariant sets of the following lifted system:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"beginaligned\ndotx_1(t)  = x_2(t)\ndotx_2(t)  = x_3(t)\ndotx_3(t)  = u(t)\nendaligned","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"with state constraint x in -1 1^3.","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"dotx(t) = Ax(t) + Bu(t)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"A = beginbmatrix\n0  1\n0  0\nendbmatrix","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"As shown in [LTJ18], a set S is controlled invariant if","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"beginbmatrix\n1  Delta t\nendbmatrix\nS subseteq\nbeginbmatrix\n1  0\nendbmatrix\nS","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"[LJ21] B. Legat and R. M. Jungers. Continuous-time controlled invariant sets, a geometric approach. 7th IFAC Conference on Analysis and Design of Hybrid Systems ADHS 2021, 2021.","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"The matricial form of this system is given by dotx(t) = Ax(t) + Bu(t) where A and B are as defined below. As shown in Proposition 5 of [LJ21], a set is controlled invariant for this system if and only if it is invariant for the algebraic system","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"beginaligned\ndotx_1(t)  = x_2(t)\ndotx_2(t)  = x_3(t)\nendaligned","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"The matricial form of this system is given by Edotx(t) = Cx(t) where","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"A = [0.0 1.0 0.0\n     0.0 0.0 1.0\n     0.0 0.0 0.0]\nB = reshape([0.0, 0.0, 1.0], 3, 1)\nE = [1.0 0.0 0.0\n     0.0 1.0 0.0]\nC = A[1:2, :]","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"The invariance of a set S for this system is characterized by the following condition (see Proposition 7 of [LJ21]):","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"forall x in partial S exists y in T_S(x) Ey = Cx","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"The search for a set satisfying this condition can be formulated as the following set program; see [L20] for an intoduction to set programming.","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"[L20] Legat, B. (2020). Set programming : theory and computation. Ph.D. thesis, UCLouvain.","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"using SetProg\nfunction maximal_invariant(family, γ = nothing; dirs=dirs)\n    model = Model(sdp_solver)\n    @variable(model, S, family)\n    @constraint(model, S ⊆ □_3)\n    x = boundary_point(S, :x)\n    @constraint(model, C * x in E * tangent_cone(S, x))\n    S_2 = project(S, 1:2)\n    if γ === nothing\n        @variable(model, γ)\n    end\n    for point in dirs\n        @constraint(model, γ * point in S_2)\n    end\n    @show γ\n    @objective(model, Max, γ)\n    @show JuMP.objective_function(model)\n    JuMP.optimize!(model)\n    @show solve_time(model)\n    @show JuMP.termination_status(model)\n    @show JuMP.objective_value(model)\n    if JuMP.termination_status(model) == MOI.OPTIMAL\n        return JuMP.value(S), JuMP.objective_value(model)\n    else\n        return\n    end\nend\n\nimport GLPK\nlp_solver = optimizer_with_attributes(GLPK.Optimizer, MOI.Silent() => true, \"presolve\" => GLPK.GLP_ON)\nimport CSDP\nsdp_solver = optimizer_with_attributes(CSDP.Optimizer, MOI.Silent() => true)\nusing Polyhedra\ninterval = HalfSpace([1.0], 1.0) ∩ HalfSpace([-1.0], 1.0)\nlib = Polyhedra.DefaultLibrary{Float64}(lp_solver)\n□_2 = polyhedron(interval * interval, lib)\n□_3 = □_2 * interval\ndirs = [[-1 + √3, -1 + √3], [-1, 1]]\nall_dirs = [dirs; (-).(dirs)]\ninner = polyhedron(vrep(all_dirs), lib)\nouter = polar(inner)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/#Ellipsoidal-template","page":"Continuous-time Controlled Invariant Set","title":"Ellipsoidal template","text":"","category":"section"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"We start with the ellipsoidal template. We consider two different objectives (see Section 4.2 of [L20]):","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"the volume of the set (which corresponds to log(det(Q)) or sqrtndet(Q) in the objective function) and\nthe sum of the squares of the length of its semi-axes of the polar (which corresponds to the trace of Q in the objective function).","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"sol_ell, γ_ell = maximal_invariant(Ellipsoid(symmetric=true))\n\nusing Plots\nfunction hexcolor(rgb::UInt32)\n    r = ((0xff0000 & rgb) >> 16) / 255\n    g = ((0x00ff00 & rgb) >>  8) / 255\n    b = ((0x0000ff & rgb)      ) / 255\n    Plots.RGBA(r, g, b)\nend","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"Values taken from http://www.toutes-les-couleurs.com/code-couleur-rvb.php","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"lichen = hexcolor(0x85c17e)\ncanard = hexcolor(0x048b9a)\naurore = hexcolor(0xffcb60)\nframbo = hexcolor(0xc72c48)\ncols = [canard, frambo]\n\nx2 = range(0, stop=1, length=20)\nx1 = 1 .- x2.^2 / 2\nupper = [[[-1, 1]]; [[x1[i], x2[i]] for i in eachindex(x2)]]\nmci = polyhedron(vrep([upper; (-).(upper)]), lib)\npolar_mci = polar(mci)\n\nSetProg.Sets.print_support_function(project(sol_ell, 1:2))","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"We can plot the primal solution as follows:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"function primal_plot(set, γ=nothing; npoints=256, xlim=(-1.05, 1.05), ylim=(-1.05, 1.05), args...)\n    plot(ratio=:equal, tickfont=Plots.font(12); xlim=xlim, ylim=ylim, args...)\n    plot!(□_2, color=lichen)\n    plot!(mci, color=aurore)\n    plot!(set, color=canard, npoints=npoints)\n    γ === nothing || plot!(γ * inner, color=frambo)\n    plot!()\nend\nprimal_plot(project(sol_ell, 1:2), γ_ell)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"and the dual plot as follows:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"function polar_plot(set, γ; npoints=256, xlim=(-1.5, 1.5), ylim=(-1.5, 1.5), args...)\n    plot(ratio=:equal, tickfont=Plots.font(12); xlim=xlim, ylim=ylim, args...)\n    γ === nothing || plot!(inv(γ) * outer, color=frambo)\n    plot!(polar(set), color=canard, npoints=npoints)\n    plot!(polar_mci, color=aurore)\n    plot!(polar(□_2), color=lichen)\nend\npolar_plot(project(sol_ell, 1:2), γ_ell)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/#Polyset-template","page":"Continuous-time Controlled Invariant Set","title":"Polyset template","text":"","category":"section"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"p4, γ4 = maximal_invariant(PolySet(symmetric=true, degree=4, convex=true), 0.91)\nγ4","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"Below is the primal plot:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"primal_plot(project(p4, 1:2), γ4)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"and here is the polar plot:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"polar_plot(project(p4, 1:2), γ4)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/#Piecewise-semi-ellipsoidal-template","page":"Continuous-time Controlled Invariant Set","title":"Piecewise semi-ellipsoidal template","text":"","category":"section"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"sol_piece_◇, γ_piece_◇ = maximal_invariant(Ellipsoid(symmetric=true, piecewise=polar(□_3)), dirs=all_dirs)\nγ_piece_◇","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"Below is the primal plot:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"primal_plot(project(sol_piece_◇, 1:2), γ_piece_◇)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"and here is the polar plot:","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"polar_plot(project(sol_piece_◇, 1:2), γ_piece_◇)","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"","category":"page"},{"location":"generated/Continuous-time Controlled Invariant Set/","page":"Continuous-time Controlled Invariant Set","title":"Continuous-time Controlled Invariant Set","text":"This page was generated using Literate.jl.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"EditURL = \"https://github.com/blegat/SetProg.jl/blob/master/docs/src/examples/Discrete-time Switched Invariant Set.jl\"","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/#Discrete-time-Invariant-Set","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Invariant Set","text":"","category":"section"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"(Image: Binder) (Image: nbviewer)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"In this notebook, we compute the maximal (resp. minimal) invariant set contained in the square with vertices (pm 1 pm 1) for the system beginalign* x_k+1  = -y_k\ny_k+1  =  x_k endalign*","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"The system is x_k+1 = Ax_k where $ A = \\begin{bmatrix} 0 & -1\\\n1 & 0 \\end{bmatrix}. $ A set S is controlled invariant if AS subseteq S","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We need to pick an LP and an SDP solver, see here for a list of available ones. Run one of the following two cells to choose choose the solver.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"using SetProg\nimport Clp\nlp_solver = optimizer_with_attributes(Clp.Optimizer, MOI.Silent() => true)\nimport CSDP\nsdp_solver = optimizer_with_attributes(CSDP.Optimizer, MOI.Silent() => true)\nusing Polyhedra\nlib = DefaultLibrary{Float64}(lp_solver)\nh = HalfSpace([1, 0], 1.0) ∩ HalfSpace([-1, 0], 1) ∩ HalfSpace([0, 1], 1) ∩ HalfSpace([0, -1], 1)\n□ = polyhedron(h, lib)\n◇ = polar(□)\nA1 = [-1 -1\n      -4  0] / 4\nA2 = [ 3  3\n      -2  1] / 4\nA = [0.0 -1.0\n     1.0  0.0]\n\nfunction maximal_invariant(template, heuristic::Function)\n    solver = if template isa Polytope\n        lp_solver\n    else\n        sdp_solver\n    end\n    model = Model(solver)\n    @variable(model, S, template)\n    @constraint(model, S ⊆ □)\n    @constraint(model, A1 * S ⊆ S)\n    @constraint(model, A2 * S ⊆ S)\n    @objective(model, Max, heuristic(volume(S)))\n    optimize!(model)\n    @show solve_time(model)\n    @show termination_status(model)\n    @show objective_value(model)\n    return value(S)\nend\nfunction minimal_invariant(template, heuristic::Function)\n    solver = if template isa Polytope\n        lp_solver\n    else\n        sdp_solver\n    end\n    model = Model(solver)\n    @variable(model, S, template)\n    @constraint(model, □ ⊆ S)\n    @constraint(model, A1 * S ⊆ S)\n    @constraint(model, A2 * S ⊆ S)\n    @objective(model, Min, heuristic(volume(S)))\n    optimize!(model)\n    @show solve_time(model)\n    @show termination_status(model)\n    @show objective_value(model)\n    @show JuMP.objective_sense(model)\n    return value(S)\nend\n\nusing Plots\nfunction hexcolor(rgb::UInt32)\n    r = ((0xff0000 & rgb) >> 16) / 255\n    g = ((0x00ff00 & rgb) >>  8) / 255\n    b = ((0x0000ff & rgb)      ) / 255\n    Plots.RGBA(r, g, b)\nend","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"Values taken from http://www.toutes-les-couleurs.com/code-couleur-rvb.php","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"lichen = hexcolor(0x85c17e)\ncanard = hexcolor(0x048b9a)\naurore = hexcolor(0xffcb60)\nframbo = hexcolor(0xc72c48)\n\nfunction primal_plot(min_sol, max_sol; npoints=256, args...)\n    plot(ratio=:equal, tickfont=Plots.font(12); args...)\n    plot!(min_sol, color=canard, npoints=npoints)\n    plot!(□, color=lichen)\n    plot!(max_sol, color=aurore, npoints=npoints)\nend\nfunction polar_plot(min_sol, max_sol; npoints=256, args...)\n    plot(ratio=:equal, tickfont=Plots.font(12); args...)\n    plot!(polar(max_sol), color=aurore, npoints=npoints)\n    plot!(◇, color=lichen)\n    plot!(polar(min_sol), color=canard, npoints=npoints)\nend","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/#Polyhedral-template","page":"Discrete-time Switched Invariant Set","title":"Polyhedral template","text":"","category":"section"},{"location":"generated/Discrete-time Switched Invariant Set/#Fixed-point-approach","page":"Discrete-time Switched Invariant Set","title":"Fixed point approach","text":"","category":"section"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"This section shows fixed point approach for computing a polyhedral maximal invariant set. We implement the fixed point iteration of the standard viability kernel algorithm with the following function. A more sophisticated approach specialized for discrete-time linear switched systems is available in SwitchOnSafety.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"function backward_fixed_point_iteration(set::Polyhedron)\n    new_set = set ∩ (A1 \\ set) ∩ (A2 \\ set)\n    removehredundancy!(new_set)\n    return new_set\nend","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We start with -1 1^2 and obtain the maximal invariant set after one iteration.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"max_polytope_1 = backward_fixed_point_iteration(□)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We can see that it has already converged.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"backward_fixed_point_iteration(max_polytope_1)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We now turn to the minimal invariant set with the following iteration:","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"function forward_fixed_point_iteration(set::Polyhedron)\n    new_set = convexhull(set, A1 * set, A2 * set)\n    removevredundancy!(new_set)\n    return new_set\nend","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We start with -1 1^2 and obtain the minimal invariant set after three iteration.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"min_polytope_1 = forward_fixed_point_iteration(□)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We see below that the second iteration was indeed needed.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"min_polytope_2 = forward_fixed_point_iteration(min_polytope_1)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"And the third iteration as well.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"min_polytope_3 = forward_fixed_point_iteration(min_polytope_2)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We see below that it has converged","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"forward_fixed_point_iteration(min_polytope_3)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"Let's see this visually","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"plot(ratio=:equal, tickfont=Plots.font(12))\nplot!(min_polytope_3, color=frambo)\nplot!(min_polytope_2, color=canard)\nplot!(min_polytope_1, color=aurore)\nplot!(□, color=lichen)\nplot!(max_polytope_1, color=frambo)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/#Linear-programming-approach","page":"Discrete-time Switched Invariant Set","title":"Linear programming approach","text":"","category":"section"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"As introduced in [R21], we can search over all polyhedra with a given face fan. The partition can be defined by the face fan of a given polytope as described in [Eq. (4.6), R21]. For maximal_invariant, because the sets are represented with the support function, the fan will be used for the face fan of the polar set the face fan of the primal set will depend on the value of the support function on each piece. For minimal_invariant, the sets are represented with the gauge function, the fac will therefore be used for the face fan of the primal set.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"[R21] Raković, S. V. Control Minkowski–Lyapunov functions Automatica, Elsevier BV, 2021, 128, 109598","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We use the face fan of the polytope pieces8 (which has the same face fan as the octogon convexhull(□, √2 * ◇)).","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"pieces8 = convexhull(□, 1.25 * ◇)\nmax_polytope = maximal_invariant(Polytope(symmetric=true, piecewise=pieces8), L1_heuristic)\nmin_polytope = minimal_invariant(Polytope(symmetric=true, piecewise=polar(pieces8)), L1_heuristic)\nprimal_plot(min_polytope, max_polytope)\n\n# Ellipsoidal template","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We now consider the ellipsoidal template. The ellipsoids of maximal volume are given as follows:","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"max_ell_vol = maximal_invariant(Ellipsoid(symmetric=true), nth_root)\nmin_ell_vol = minimal_invariant(Ellipsoid(symmetric=true), nth_root)\nprimal_plot(min_ell_vol, max_ell_vol)\npolar_plot(min_ell_vol, max_ell_vol)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"The ellipsoids of maximal sum of squared length of its axis.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"max_ell_L1 = maximal_invariant(Ellipsoid(symmetric=true), vol -> L1_heuristic(vol, ones(2)))\nmin_ell_L1 = minimal_invariant(Ellipsoid(symmetric=true), vol -> L1_heuristic(vol, ones(2)))\nprimal_plot(min_ell_L1, max_ell_L1)\nsavefig(\"AJPR14e54ell.png\")\n\n# Polyset template","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We generalize the previous template to homogeneous polynomials of degree 2d. As objective, we use the integral of the polynomial used to represent the set (either in the support function for maximal_invariant or in the gauge function for minimal_invariant) over the square. We start with quartic polynomials.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"max_4 = maximal_invariant(PolySet(symmetric=true, convex=true, degree=4), vol -> L1_heuristic(vol, ones(2)))\nmin_4 = minimal_invariant(PolySet(symmetric=true, degree=4), vol -> L1_heuristic(vol, ones(2)))\nprimal_plot(min_4, max_4)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"We now obtain the results for sextic polynomials, note that we do not impose the sets to be convex for minimal_invariant.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"max_6 = maximal_invariant(PolySet(symmetric=true, convex=true, degree=6), vol -> L1_heuristic(vol, ones(2)))\nmin_6 = minimal_invariant(PolySet(symmetric=true, degree=6), vol -> L1_heuristic(vol, ones(2)))\nprimal_plot(min_6, max_6)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"The nonconvexity is even more apparent for octic polynomials.","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"max_8 = maximal_invariant(PolySet(symmetric=true, convex=true, degree=8), vol -> L1_heuristic(vol, □))\nmin_8 = minimal_invariant(PolySet(symmetric=true, degree=8), vol -> L1_heuristic(vol, □))\nprimal_plot(min_8, max_8, npoints=1024)","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"","category":"page"},{"location":"generated/Discrete-time Switched Invariant Set/","page":"Discrete-time Switched Invariant Set","title":"Discrete-time Switched Invariant Set","text":"This page was generated using Literate.jl.","category":"page"},{"location":"#SetProg","page":"Index","title":"SetProg","text":"","category":"section"},{"location":"","page":"Index","title":"Index","text":"SetProg is a JuMP extension for Set Programming : optimization with set variables and inclusion/containment constraints. This package allows the formulation of a mathematical programming involving both classical variables and constraints supported by JuMP and set variables and constraints.","category":"page"}]
}
